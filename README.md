# 요구사항
- 선착순 100명에게 할인쿠폰을 제공하는 이벤트를 진행하고자 한다.
1. 이 이벤트는 아래와 같은 조건을 만족하여야 한다. (동시성과 디비 처리 이슈)
  - 선착순 100명에게만 지급되어야한다.
  - 101개 이상이 지급되면 안된다.
  - 순간적으로 몰리는 트래픽을 버틸 수 있어야합니다.
2. 유저당 한번만 쿠폰을 발급받아야 합니다. (따닥이슈)

---
# 분석
## Redis
- Redis를 사용하는 이유는, 싱글스레드이기 때문입니다.
  - 쿠폰 발행 요청을 받았을 때, 쿠폰 발행 요청 카운트 처리
    - 쿠폰 발행 요청 카운트가 100개 이상이 되면, 쿠폰 발행 요청을 거부
- Redis Set 자료구조를 사용하는 이유는, 중복 제거를 목표로 합니다.
  - 한 유저의 여러 요청을 동시에 받았을 때, 
  - 중복된 쿠폰 발행 요청을 거부하기 위함입니다.
---
## Kafka
- Kafka를 사용하는 주된 이유 중 하나는 확실히 데이터 처리의 유연성과 부하 분산에 있습니다. 
  - Kafka를 활용함으로써, 많은 양의 이벤트(예: 쿠폰 발행 요청)를 바로 처리하지 않고 큐에 보관했다가, 
  - 시스템의 부하가 적은 시기에 또는 자원이 더욱 충분할 때 일괄적으로 처리할 수 있게 됩니다. 
  - 이는 데이터베이스에 대한 부하를 효과적으로 관리하고, 전체적인 시스템 성능과 안정성을 향상시키는 데 도움을 줍니다.
- 이러한 이유로, 쿠폰 발행 요청을 Kafka를 통해 처리하는 것이 좋습니다. 
  1. 쿠폰 발행 요청을 Kafka에 보내고, 
  2. Kafka 컨슈머에서는 쿠폰 발행 요청을 받아 처리합니다. 
  3. 이때, 쿠폰 발행 요청을 받은 컨슈머는 쿠폰 발행 요청을 처리하고, 
  4. 쿠폰 발행 결과를 다시 Kafka에 보내어, 
  5. 쿠폰 발행 결과를 받은 컨슈머는 쿠폰 발행 결과를 데이터베이스에 저장합니다.
- 에러 핸들링
  - https://www.confluent.io/blog/error-handling-patterns-in-kafka/
